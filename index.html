<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>éŸ©è¯­å¯¹è¯ç»ƒä¹  - ç•™å­¦ç”Ÿåœºæ™¯æ¨¡æ‹Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #e0f2fe, #eef2ff);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
      color: #111827;
    }
    .app {
      width: 100%;
      max-width: 1100px;
      background: #ffffffee;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.18);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      padding: 14px 18px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.9);
    }
    .title-box h1 {
      font-size: 20px;
      font-weight: 800;
    }
    .title-box p {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }
    .badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      border: 1px solid #c7d2fe;
    }
    .main {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 520px;
    }
    .left {
      border-right: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 12px;
    }
    .left h2 {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .left p.desc {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    .scene-list {
      max-height: 430px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }
    .scene-btn {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid transparent;
      background: #ffffff;
      cursor: pointer;
      text-align: left;
      transition: all 0.15s ease;
      font-size: 12px;
    }
    .scene-btn:hover {
      background: #eef2ff;
      border-color: #c7d2fe;
    }
    .scene-btn.active {
      background: #e0e7ff;
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.25);
    }
    .scene-icon {
      font-size: 18px;
      margin-top: 1px;
    }
    .scene-main {
      font-weight: 700;
      color: #111827;
    }
    .scene-sub {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .right {
      display: flex;
      flex-direction: column;
      background: #f3f4f6;
    }
    .chat-header {
      padding: 10px 14px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ffffffcc;
    }
    .scene-info-title {
      font-size: 14px;
      font-weight: 700;
    }
    .scene-info-sub {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }
    .btn-small {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #c7d2fe;
      background: #eef2ff;
      color: #4f46e5;
      cursor: pointer;
    }
    .btn-small:hover {
      background: #e0e7ff;
    }

    .chat-body {
      flex: 1;
      padding: 10px 14px;
      overflow-y: auto;
    }
    .msg-row {
      display: flex;
      margin-bottom: 8px;
    }
    .msg-row.user {
      justify-content: flex-end;
    }
    .msg-bubble {
      max-width: 78%;
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    .msg-bubble.user {
      background: #4f46e5;
      color: #f9fafb;
      border-bottom-right-radius: 4px;
    }
    .msg-bubble.bot {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      color: #111827;
      border-bottom-left-radius: 4px;
    }
    .msg-meta {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 1px;
    }
    .typing {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: #6b7280;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #4f46e5;
      animation: bounce 1s infinite;
    }
    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }

    .chat-input {
      padding: 10px 14px;
      border-top: 1px solid #e5e7eb;
      background: #ffffff;
      display: flex;
      gap: 8px;
    }
    .chat-input input {
      flex: 1;
      font-size: 13px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      outline: none;
    }
    .chat-input input:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.25);
    }
    .send-btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      background: #4f46e5;
      color: white;
      cursor: pointer;
    }
    .send-btn:disabled {
      background: #9ca3af;
      cursor: default;
    }

    footer {
      font-size: 10px;
      color: #9ca3af;
      text-align: right;
      padding: 4px 10px 8px;
      background: #ffffffdd;
      border-top: 1px solid #e5e7eb;
    }

    @media (max-width: 880px) {
      .main {
        grid-template-columns: 1fr;
      }
      .left {
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-box">
        <h1>AI éŸ©è¯­å¯¹è¯æ•™ç»ƒ Â· ç•™å­¦ç”Ÿç‰ˆ</h1>
        <p>æ¨¡æ‹ŸéŸ©å›½ç”Ÿæ´»åœºæ™¯ï¼ˆé“¶è¡Œ / æˆ¿ä¸œ / è¯¾å ‚ç­‰ï¼‰ï¼Œå¸®åŠ©ä¸­å›½ç•™å­¦ç”Ÿç»ƒä¹ éŸ©è¯­å¯¹è¯</p>
      </div>
      <div class="badge">æœŸæœ«ä½œä¸š Â· ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜</div>
    </header>

    <div class="main">
      <section class="left">
        <h2>â‘  é€‰æ‹©ç»ƒä¹ åœºæ™¯</h2>
        <p class="desc">
          é€‰æ‹©ä½ æƒ³ç»ƒä¹ çš„ç”Ÿæ´»åœºæ™¯ï¼Œç„¶åç”¨éŸ©è¯­è¾“å…¥ä½ æƒ³è¯´çš„è¯ã€‚
          ç³»ç»Ÿä¼šç»™å‡ºç®€å•çº é”™å»ºè®® + éŸ©è¯­å›å¤ + ä¸­æ–‡è§£é‡Šã€‚
        </p>
        <div class="scene-list" id="sceneList"></div>
      </section>

      <section class="right">
        <div class="chat-header">
          <div>
            <div class="scene-info-title" id="sceneTitle">è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªåœºæ™¯</div>
            <div class="scene-info-sub" id="sceneSub">
              ä¾‹å¦‚ï¼šé“¶è¡Œã€é‚®å±€ã€æˆ¿ä¸œã€æ•™æˆã€æœ‹å‹ã€æœºåœºã€å‡ºå…¥å¢ƒä¸­å¿ƒã€å…¬äº¤è½¦ã€å¤§å·´ç«™ã€é¥­åº—ã€ç´§æ€¥æƒ…å†µã€è¯¾å ‚ç­‰ã€‚
            </div>
          </div>
          <button class="btn-small" id="resetBtn">é‡æ–°å¼€å§‹å½“å‰åœºæ™¯</button>
        </div>

        <div class="chat-body" id="chatBody">
          <!-- èŠå¤©å†…å®¹ -->
        </div>

        <div class="chat-input">
          <input
            type="text"
            id="userInput"
            placeholder="ç”¨éŸ©è¯­è¾“å…¥ä½ æƒ³è¯´çš„è¯ï¼Œä¾‹å¦‚ï¼šê³„ì¢Œë¥¼ ë§Œë“¤ê³  ì‹¶ì–´ìš”."
          />
          <button class="send-btn" id="sendBtn">å‘é€</button>
        </div>
      </section>
    </div>

    <footer>
      Made for í•œêµ­ ìœ í•™ìƒ Â· í•œêµ­ì–´ íšŒí™” ì—°ìŠµ | ê¸°ë§ê³ ì‚¬ ëŒ€ì²´ê³¼ì œ
    </footer>
  </div>

  <script>
    // åœºæ™¯å®šä¹‰
    const SCENARIOS = [
      {
        id: "bank",
        icon: "ğŸ¦",
        title: "é“¶è¡Œ",
        subtitle: "å¼€æˆ·ã€æ±‡æ¬¾ã€æ¢é’±ã€è¯¢é—®æ‰‹ç»­è´¹",
        role: "ì€í–‰ ì§ì› (é“¶è¡ŒèŒå‘˜)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”, ì€í–‰ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì–´ë–¤ ì—…ë¬´ ë³´ëŸ¬ ì˜¤ì…¨ì–´ìš”?",
        greetingCn: "æ‚¨å¥½ï¼Œè¿™é‡Œæ˜¯é“¶è¡Œã€‚è¯·é—®æ‚¨ä»Šå¤©æƒ³åŠç†ä»€ä¹ˆä¸šåŠ¡ï¼Ÿ"
      },
      {
        id: "post",
        icon: "ğŸ“®",
        title: "é‚®å±€",
        subtitle: "å¯„åŒ…è£¹ã€ä¹°é‚®ç¥¨ã€å¿«é€’ã€æŒ‚å·",
        role: "ìš°ì²´êµ­ ì§ì› (é‚®å±€èŒå‘˜)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”, ìš°ì²´êµ­ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë³´ë‚´ì‹œê² ì–´ìš”?",
        greetingCn: "æ‚¨å¥½ï¼Œè¿™é‡Œæ˜¯é‚®å±€ã€‚è¯·é—®æ‚¨è¦å¯„ä»€ä¹ˆï¼Ÿ"
      },
      {
        id: "immigration",
        icon: "ğŸ›‚",
        title: "å‡ºå…¥å¢ƒä¸­å¿ƒ",
        subtitle: "ç­¾è¯å»¶æœŸã€å¤–å›½äººç™»å½•è¯ã€åœ°å€å˜æ›´",
        role: "ì¶œì…êµ­ ì§ì› (å‡ºå…¥å¢ƒå·¥ä½œäººå‘˜)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”, ì¶œì…êµ­Â·ì™¸êµ­ì¸ì²­ì…ë‹ˆë‹¤. ì–´ë–¤ ì—…ë¬´ë¡œ ì˜¤ì…¨ì–´ìš”?",
        greetingCn: "æ‚¨å¥½ï¼Œè¿™é‡Œæ˜¯å‡ºå…¥å¢ƒÂ·å¤–å›½äººå…ã€‚è¯·é—®æ‚¨æ¥åŠç†ä»€ä¹ˆä¸šåŠ¡ï¼Ÿ"
      },
      {
        id: "airport",
        icon: "âœˆï¸",
        title: "æœºåœº",
        subtitle: "æ‰˜è¿è¡Œæã€ç™»æœºã€é—®ç™»æœºå£",
        role: "ê³µí•­ ì§ì› (æœºåœºå·¥ä½œäººå‘˜)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”, ê³µí•­ ì•ˆë‚´ì…ë‹ˆë‹¤. ì–´ë””ë¡œ ê°€ì‹œëŠ” í•­ê³µí¸ì´ì„¸ìš”?",
        greetingCn: "æ‚¨å¥½ï¼Œè¿™é‡Œæ˜¯æœºåœºæœåŠ¡å°ã€‚è¯·é—®æ‚¨è¦ä¹˜åå»å“ªé‡Œçš„èˆªç­ï¼Ÿ"
      },
      {
        id: "express",
        icon: "ğŸšŒ",
        title: "å¤§å·´å®¢è¿ç«™",
        subtitle: "ä¹°ç¥¨ã€ç¡®è®¤æ—¶é—´ã€ä¸Šè½¦åœ°ç‚¹",
        role: "í„°ë¯¸ë„ ì§ì› (å®¢è¿ç«™å·¥ä½œäººå‘˜)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”, ê³ ì†ë²„ìŠ¤ í„°ë¯¸ë„ì…ë‹ˆë‹¤. ì–´ë””ê¹Œì§€ ê°€ëŠ” í‘œë¥¼ ì°¾ìœ¼ì„¸ìš”?",
        greetingCn: "æ‚¨å¥½ï¼Œè¿™é‡Œæ˜¯é«˜é€Ÿå¤§å·´å®¢è¿ç«™ã€‚æ‚¨è¦ä¹°å»å“ªé‡Œçš„è½¦ç¥¨ï¼Ÿ"
      },
      {
        id: "bus",
        icon: "ğŸš",
        title: "å…¬äº¤è½¦",
        subtitle: "é—®è·¯ã€ç¡®è®¤åˆ°ç«™ã€æ¢ä¹˜",
        role: "ë²„ìŠ¤ ê¸°ì‚¬ë‹˜ (å…¬äº¤å¸æœº)",
        greeting: "ì–´ë””ê¹Œì§€ ê°€ì„¸ìš”?",
        greetingCn: "æ‚¨è¦ååˆ°å“ªé‡Œï¼Ÿ"
      },
      {
        id: "restaurant",
        icon: "ğŸ½ï¸",
        title: "é¥­åº— / é¤å…",
        subtitle: "ç‚¹é¤ã€è¦ä¸è¾£ã€æ‰“åŒ…ã€ç»“è´¦",
        role: "ì‹ë‹¹ ì§ì› (é¤å…æœåŠ¡å‘˜)",
        greeting: "ì–´ì„œì˜¤ì„¸ìš”! ëª‡ ë¶„ì´ì„¸ìš”?",
        greetingCn: "æ¬¢è¿å…‰ä¸´ï¼è¯·é—®å‡ ä½ï¼Ÿ"
      },
      {
        id: "emergency",
        icon: "ğŸš‘",
        title: "ç´§æ€¥æƒ…å†µ",
        subtitle: "æ‰“119ã€æ€¥è¯Šå®¤ã€è¯´æ˜ç—‡çŠ¶",
        role: "ì‘ê¸‰ì‹¤ ê°„í˜¸ì‚¬ (æ€¥è¯Šå®¤æŠ¤å£«)",
        greeting: "ì–´ë””ê°€ ì–´ë–»ê²Œ ë¶ˆí¸í•˜ì‹ ê°€ìš”?",
        greetingCn: "å“ªé‡Œä¸èˆ’æœï¼Ÿè¯·è¯´ä¸€ä¸‹æ‚¨çš„ç—‡çŠ¶ã€‚"
      },
      {
        id: "classroom",
        icon: "ğŸ«",
        title: "è¯¾å ‚",
        subtitle: "è·Ÿæ•™æˆå¯¹è¯ã€è¯·å‡ã€é—®ä½œä¸š",
        role: "êµìˆ˜ë‹˜ (æ•™æˆ)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”. ìˆ˜ì—…ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆë‚˜ìš”?",
        greetingCn: "ä½ å¥½ã€‚å…³äºè¯¾ç¨‹æœ‰ä»€ä¹ˆæƒ³é—®çš„å—ï¼Ÿ"
      },
      {
        id: "landlord",
        icon: "ğŸ ",
        title: "æˆ¿ä¸œ",
        subtitle: "çœ‹æˆ¿ã€æŠ¼é‡‘ã€æœˆç§Ÿã€æŠ¥ä¿®",
        role: "ì§‘ì£¼ì¸ (æˆ¿ä¸œ)",
        greeting: "ì•ˆë…•í•˜ì„¸ìš”. ë°© ë³´ëŸ¬ ì˜¤ì…¨ì–´ìš”?",
        greetingCn: "ä½ å¥½ï¼Œæ˜¯æ¥çœ‹æˆ¿çš„å—ï¼Ÿ"
      },
      {
        id: "professor",
        icon: "ğŸ‘¨â€ğŸ«",
        title: "æ•™æˆ",
        subtitle: "è®ºæ–‡ã€ä½œä¸šã€æ¨èä¿¡",
        role: "ì§€ë„ êµìˆ˜ë‹˜ (æŒ‡å¯¼æ•™æˆ)",
        greeting: "ë„¤, ë§ì”€í•˜ì„¸ìš”. ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”?",
        greetingCn: "å¥½çš„ï¼Œä½ è¯´å§ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"
      },
      {
        id: "friend",
        icon: "ğŸ‘¥",
        title: "éŸ©å›½æœ‹å‹",
        subtitle: "æ—¥å¸¸èŠå¤©ã€çº¦é¥­ã€å‡ºå»ç©",
        role: "í•œêµ­ ì¹œêµ¬ (éŸ©å›½æœ‹å‹)",
        greeting: "ì•ˆë…•! ìš”ì¦˜ ì–´ë–»ê²Œ ì§€ë‚´?",
        greetingCn: "å—¨ï¼ä½ æœ€è¿‘è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ"
      }
    ];

    let currentScenario = null;
    let isThinking = false;

    const sceneListEl = document.getElementById("sceneList");
    const chatBodyEl = document.getElementById("chatBody");
    const sceneTitleEl = document.getElementById("sceneTitle");
    const sceneSubEl = document.getElementById("sceneSub");
    const userInputEl = document.getElementById("userInput");
    const sendBtnEl = document.getElementById("sendBtn");
    const resetBtnEl = document.getElementById("resetBtn");

    // æ¸²æŸ“åœºæ™¯åˆ—è¡¨
    function renderSceneList() {
      sceneListEl.innerHTML = "";
      SCENARIOS.forEach(scene => {
        const btn = document.createElement("button");
        btn.className = "scene-btn";
        btn.dataset.id = scene.id;
        btn.innerHTML = `
          <div class="scene-icon">${scene.icon}</div>
          <div>
            <div class="scene-main">${scene.title}</div>
            <div class="scene-sub">${scene.subtitle}</div>
          </div>
        `;
        btn.addEventListener("click", () => selectScenario(scene.id));
        sceneListEl.appendChild(btn);
      });
    }

    function updateSceneActive() {
      const buttons = sceneListEl.querySelectorAll(".scene-btn");
      buttons.forEach(btn => {
        if (currentScenario && btn.dataset.id === currentScenario.id) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    function clearChat() {
      chatBodyEl.innerHTML = "";
    }

    function addMessage(role, text, meta) {
      const row = document.createElement("div");
      row.className = "msg-row " + (role === "user" ? "user" : "bot");

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble " + (role === "user" ? "user" : "bot");
      bubble.textContent = text;
      row.appendChild(bubble);

      chatBodyEl.appendChild(row);

      if (meta) {
        const metaEl = document.createElement("div");
        metaEl.className = "msg-meta";
        metaEl.textContent = meta;
        chatBodyEl.appendChild(metaEl);
      }

      chatBodyEl.scrollTop = chatBodyEl.scrollHeight;
    }

    function addTypingIndicator() {
      const row = document.createElement("div");
      row.className = "msg-row bot";
      row.id = "typingRow";

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble bot";

      const container = document.createElement("div");
      container.className = "typing";
      const d1 = document.createElement("div");
      d1.className = "dot";
      const d2 = document.createElement("div");
      d2.className = "dot";
      const d3 = document.createElement("div");
      d3.className = "dot";
      container.appendChild(d1);
      container.appendChild(d2);
      container.appendChild(d3);

      const text = document.createElement("span");
      text.textContent = " ìƒê° ì¤‘â€¦ / æ­£åœ¨æ€è€ƒå›å¤â€¦";
      container.appendChild(text);

      bubble.appendChild(container);
      row.appendChild(bubble);
      chatBodyEl.appendChild(row);
      chatBodyEl.scrollTop = chatBodyEl.scrollHeight;
    }

    function removeTypingIndicator() {
      const row = document.getElementById("typingRow");
      if (row) {
        row.remove();
      }
    }

    function selectScenario(id) {
      currentScenario = SCENARIOS.find(s => s.id === id);
      updateSceneActive();
      clearChat();

      if (currentScenario) {
        sceneTitleEl.textContent = `åœºæ™¯ï¼š${currentScenario.title}`;
        sceneSubEl.textContent = `${currentScenario.role} Â· ${currentScenario.subtitle}`;
        addMessage(
          "bot",
          currentScenario.greeting + "\n\nã€ç¿»è¯‘ã€‘\n" + currentScenario.greetingCn,
          currentScenario.role
        );
      } else {
        sceneTitleEl.textContent = "è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªåœºæ™¯";
        sceneSubEl.textContent = "ä¾‹å¦‚é“¶è¡Œã€é‚®å±€ã€æœºåœºã€æˆ¿ä¸œã€æœ‹å‹ã€è¯¾å ‚ç­‰ã€‚";
      }
    }

    function hasHangul(text) {
      return /[ã„±-ã…ê°€-í£]/.test(text);
    }

    function isPolite(text) {
      const trimmed = text.trim();
      const politeEndings = ["ìš”", "ë‹ˆë‹¤", "ì„¸ìš”", "ì‹­ì‹œì˜¤", "ì—ìš”", "ì˜ˆìš”"];
      return politeEndings.some(end => trimmed.endsWith(end));
    }

    function buildCorrection(userText) {
      const hasKo = hasHangul(userText);
      if (!hasKo) {
        return {
          error: userText,
          suggest: "ê°€ëŠ¥í•˜ë©´ í•œêµ­ì–´ë¡œ ì…ë ¥í•´ ë³´ì„¸ìš”. (ä¾‹å¦‚ï¼šê³„ì¢Œë¥¼ ë§Œë“¤ê³  ì‹¶ì–´ìš”.)",
          explain: "ä¸ºäº†ç»ƒä¹ éŸ©è¯­ï¼Œè¿™é‡Œå»ºè®®å°½é‡ä½¿ç”¨éŸ©æ–‡è¾“å…¥ã€‚"
        };
      }

      // æœ‹å‹åœºæ™¯å¯ä»¥ç”¨åŠè¯­ï¼Œä¸å¼ºåˆ¶æ•¬è¯­
      if (currentScenario && currentScenario.id === "friend") {
        return null;
      }

      const polite = isPolite(userText);
      if (!polite) {
        return {
          error: userText,
          suggest: userText + "ìš”",
          explain: "åœ¨æ­£å¼åœºåˆï¼ˆé“¶è¡Œã€å‡ºå…¥å¢ƒã€æ•™æˆç­‰ï¼‰ï¼Œå»ºè®®ä½¿ç”¨æ•¬è¯­å¥å°¾ï¼Œä¾‹å¦‚ä»¥â€œìš”â€æˆ–â€œì…ë‹ˆë‹¤â€ç»“å°¾ã€‚"
        };
      }

      return null;
    }

    function buildScenarioReply(userText) {
      if (!currentScenario) return {
        ko: "ì¥ë©´ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.",
        cn: "è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåœºæ™¯ã€‚"
      };

      const role = currentScenario.role;
      const base = currentScenario.id;

      switch (base) {
        case "bank":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. ë°©ê¸ˆ ì´ë ‡ê²Œ ë§ì”€í•˜ì…¨ì–´ìš”: "${userText}"
ê³„ì¢Œ ê°œì„¤, ì†¡ê¸ˆ, í™˜ì „, ìˆ˜ìˆ˜ë£Œ í™•ì¸ ê°™ì€ í‘œí˜„ì„ ë§ì´ ì—°ìŠµí•´ ë³´ì‹œë©´ ì¢‹ì•„ìš”.`,
            cn: `è¿™é‡Œæ˜¯é“¶è¡ŒèŒå‘˜ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥å¤šç»ƒä¹ ã€å¼€æˆ·ã€æ±‡æ¬¾ã€æ¢é’±ã€é—®æ‰‹ç»­è´¹ã€‘è¿™äº›è¡¨è¾¾ã€‚`
          };
        case "post":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}"ë¼ê³  í•˜ì…¨ë„¤ìš”.
ë³´ë‚´ëŠ” ë‚˜ë¼, ë“±ê¸°/ì¼ë°˜, ë¬´ê²Œì™€ ìš”ê¸ˆì— ëŒ€í•œ ë§ì„ í•¨ê»˜ ì—°ìŠµí•´ ë´…ì‹œë‹¤.`,
            cn: `è¿™é‡Œæ˜¯é‚®å±€èŒå‘˜ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ä¸€èµ·ç»ƒä¹ ã€å¯„å¾€å“ªä¸ªå›½å®¶ã€æŒ‚å·/æ™®é€šã€é‡é‡å’Œè´¹ç”¨ã€‘ç›¸å…³å¥å­ã€‚`
          };
        case "immigration":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}"ë¼ê³  í•˜ì…¨êµ°ìš”.
ë¹„ì ì—°ì¥, ì²´ë¥˜ ìê²©, ì£¼ì†Œ ë³€ê²½ ë“±ì„ í•œêµ­ì–´ë¡œ ì„¤ëª…í•´ ë³´ëŠ” ì—°ìŠµì„ í•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯å‡ºå…¥å¢ƒå·¥ä½œäººå‘˜ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ç»ƒä¹ ç”¨éŸ©è¯­è¯´æ˜ã€ç­¾è¯å»¶æœŸã€å±…ç•™èµ„æ ¼ã€åœ°å€å˜æ›´ã€‘ç­‰æƒ…å†µã€‚`
          };
        case "airport":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}" ì˜ ë§ì”€í•˜ì…¨ì–´ìš”.
ì¶œêµ­ì¥ ìœ„ì¹˜, íƒ‘ìŠ¹êµ¬, ìˆ˜í•˜ë¬¼ ê´€ë ¨ í‘œí˜„ì„ ë” ë§í•´ ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.`,
            cn: `è¿™é‡Œæ˜¯æœºåœºå·¥ä½œäººå‘˜ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ï¼Œè¯´å¾—ä¸é”™ã€‚å¯ä»¥å¤šç»ƒä¹ ã€å‡ºå¢ƒå¤§å…ã€ç™»æœºå£ã€è¡Œææ‰˜è¿ã€‘ç›¸å…³è¡¨è¾¾ã€‚`
          };
        case "express":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. ë°©ê¸ˆ "${userText}"ë¼ê³  í•˜ì…¨ë„¤ìš”.
ì¶œë°œ ì‹œê°„, ë„ì°© ì‹œê°„, íƒ‘ìŠ¹ ì¥ì†Œë¥¼ ë¬»ëŠ” í‘œí˜„ì„ ì—°ìŠµí•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯å®¢è¿ç«™å·¥ä½œäººå‘˜ã€‚ä½ åˆšåˆšè¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ç»ƒä¹ ã€å‘è½¦æ—¶é—´ã€åˆ°è¾¾æ—¶é—´ã€ä¸Šè½¦åœ°ç‚¹ã€‘çš„å¥å­ã€‚`
          };
        case "bus":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}" ì˜ ë“¤ì—ˆìŠµë‹ˆë‹¤.
ì–´ë””ê¹Œì§€ ê°€ëŠ”ì§€, ëª‡ ì •ê±°ì¥ì¸ì§€, í™˜ìŠ¹ì´ í•„ìš”í•œì§€ ë¬»ëŠ” í‘œí˜„ì„ ì—°ìŠµí•´ ë³´ì‹œë©´ ì¢‹ì•„ìš”.`,
            cn: `è¿™é‡Œæ˜¯å…¬äº¤å¸æœºã€‚å¬åˆ°ä½ è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ç»ƒä¹ ã€åˆ°å“ªé‡Œä¸‹è½¦ã€å‡ ç«™ã€è¦ä¸è¦æ¢ä¹˜ã€‘è¿™äº›é—®è·¯è¡¨è¾¾ã€‚`
          };
        case "restaurant":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}"ë¼ê³  ì£¼ë¬¸í•´ ë´¤ë„¤ìš”.
ì¸ì› ìˆ˜, ë§µê¸° ì¡°ì ˆ, ë°˜ì°¬ ì¶”ê°€, ê³„ì‚°í•˜ê¸° ê°™ì€ ë§ì„ ë” ì—°ìŠµí•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯é¤å…æœåŠ¡å‘˜ã€‚ä½ åˆšæ‰è¿™æ ·ç‚¹é¤ï¼šâ€œ${userText}â€ã€‚å¯ä»¥å†å¤šç»ƒä¹ ã€äººæ•°ã€è¦ä¸è¦è¾£ã€åŠ å°èœã€ç»“è´¦ã€‘è¿™äº›å¥å­ã€‚`
          };
        case "emergency":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}"ë¼ê³  í•˜ì…¨êµ°ìš”.
ì–¸ì œë¶€í„° ì•„íŒ ëŠ”ì§€, ì–´ë””ê°€ ì–¼ë§ˆë‚˜ ì•„í”ˆì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ì—°ìŠµì„ í•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯æ€¥è¯Šå®¤æŠ¤å£«ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ç»ƒä¹ æ›´å…·ä½“åœ°è¯´æ˜ã€ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹ç—›ã€å“ªé‡Œç—›ã€ç—›å¾—å¤šå‰å®³ã€‘ã€‚`
          };
        case "classroom":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}" ì˜ ì§ˆë¬¸í•˜ì…¨ì–´ìš”.
ê³¼ì œ ë§ˆê°ì¼, ì‹œí—˜ ë²”ìœ„, ë°œí‘œ ìˆœì„œ ë“±ì„ ë¬»ëŠ” í‘œí˜„ì„ ê³„ì† ì—°ìŠµí•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯æ•™æˆã€‚ä½ åˆšæ‰é—®ï¼šâ€œ${userText}â€ï¼Œé—®å¾—å¾ˆå¥½ã€‚å¯ä»¥ç»§ç»­ç»ƒä¹ ã€ä½œä¸šæˆªæ­¢æ—¶é—´ã€è€ƒè¯•èŒƒå›´ã€å‘è¡¨é¡ºåºã€‘è¿™äº›æé—®ã€‚`
          };
        case "landlord":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. ë°©ê¸ˆ "${userText}"ë¼ê³  ë§ì”€í•˜ì…¨ë„¤ìš”.
ë³´ì¦ê¸ˆ, ì›”ì„¸, ê´€ë¦¬ë¹„, ê³„ì•½ ê¸°ê°„, ê³ ì¥ ìˆ˜ë¦¬ ìš”ì²­ í‘œí˜„ì„ ìì£¼ ì‚¬ìš©í•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯æˆ¿ä¸œã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥å¤šç»ƒä¹ ã€æŠ¼é‡‘ã€æœˆç§Ÿã€ç®¡ç†è´¹ã€åˆåŒæœŸé™ã€æŠ¥ä¿®ã€‘çš„è¡¨è¾¾ã€‚`
          };
        case "professor":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}"ë¼ê³  í•˜ì…¨êµ°ìš”.
ë…¼ë¬¸ ì£¼ì œ, ì°¸ê³  ë¬¸í—Œ, ì—°êµ¬ ë°©ë²•ì„ í•œêµ­ì–´ë¡œ ì„¤ëª…í•˜ëŠ” ì—°ìŠµì„ ê³„ì†í•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯æŒ‡å¯¼æ•™æˆã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ã€‚å¯ä»¥ç»ƒä¹ ç”¨éŸ©è¯­è¯´æ˜ã€è®ºæ–‡é¢˜ç›®ã€å‚è€ƒæ–‡çŒ®ã€ç ”ç©¶æ–¹æ³•ã€‘ã€‚`
          };
        case "friend":
          return {
            ko: `${role}ì…ë‹ˆë‹¤. "${userText}" ì˜ ë§í–ˆì–´ìš”!
ì·¨ë¯¸, ìŒì‹, ì—¬í–‰, í•œêµ­ ìƒí™œì— ëŒ€í•´ í¸í•˜ê²Œ ì´ì•¼ê¸°í•˜ëŠ” ì—°ìŠµì„ ë§ì´ í•´ ë³´ì„¸ìš”.`,
            cn: `è¿™é‡Œæ˜¯éŸ©å›½æœ‹å‹ã€‚ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ï¼Œè¯´å¾—å¾ˆå¥½ï¼å¯ä»¥å¤šç»ƒä¹ èŠã€å…´è¶£ã€åƒä»€ä¹ˆã€æ—…è¡Œã€åœ¨éŸ©å›½ç”Ÿæ´»ã€‘è¿™äº›è½»æ¾è¯é¢˜ã€‚`
          };
        default:
          return {
            ko: `"${userText}"ë¼ê³  ì˜ ë§ì”€í•˜ì…¨ì–´ìš”. ì´ ì¥ë©´ì—ì„œ ìì£¼ ì“°ëŠ” í‘œí˜„ì„ ì—¬ëŸ¬ ê°€ì§€ ì‹œë„í•´ ë³´ì„¸ìš”.`,
            cn: `ä½ åˆšæ‰è¯´ï¼šâ€œ${userText}â€ï¼Œè¯´å¾—ä¸é”™ã€‚å¯ä»¥å¤šå°è¯•è¿™ä¸ªåœºæ™¯é‡Œå¸¸ç”¨çš„å…¶ä»–å¥å­ã€‚`
          };
      }
    }

    function handleSend() {
      if (isThinking) return;
      const text = userInputEl.value.trim();
      if (!text) return;
      if (!currentScenario) {
        alert("è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªç»ƒä¹ åœºæ™¯ã€‚");
        return;
      }

      addMessage("user", text, "å­¦ç”Ÿ / å­¦ìŠµì");
      userInputEl.value = "";
      userInputEl.focus();

      const correction = buildCorrection(text);
      const replyInfo = buildScenarioReply(text);

      isThinking = true;
      addTypingIndicator();

      setTimeout(() => {
        removeTypingIndicator();
        let botText = "";

        if (correction) {
          botText += "ã€çº é”™ã€‘\n";
          botText += "âŒ åŸå¥: " + correction.error + "\n";
          botText += "âœ… å»ºè®®: " + correction.suggest + "\n";
          botText += "ğŸ’¡ è¯´æ˜: " + correction.explain + "\n\n";
        }

        botText += "ã€å›åº”ã€‘\n" + replyInfo.ko + "\n\nã€ç¿»è¯‘ã€‘\n" + replyInfo.cn;

        addMessage("bot", botText, currentScenario.role + " Â· AI éŸ©è¯­æ•™ç»ƒ");
        isThinking = false;
      }, 700);
    }

    function resetCurrentScenario() {
      if (!currentScenario) {
        clearChat();
        sceneTitleEl.textContent = "è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªåœºæ™¯";
        sceneSubEl.textContent = "ä¾‹å¦‚é“¶è¡Œã€é‚®å±€ã€æœºåœºã€æˆ¿ä¸œã€æœ‹å‹ã€è¯¾å ‚ç­‰ã€‚";
        return;
      }
      selectScenario(currentScenario.id);
    }

    // äº‹ä»¶ç»‘å®š
    sendBtnEl.addEventListener("click", handleSend);
    userInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        handleSend();
      }
    });
    resetBtnEl.addEventListener("click", resetCurrentScenario);

    // åˆå§‹åŒ–
    renderSceneList();
  </script>
</body>
</html>
